# Developer notes

## New version

**Precondition:** We want a new release on main. No changes apart from new version numbers (and/or changelog infos) should be made.

**Tasks:**

```
yarn release:patch|minor|major
```

This will do the following:

- increment that version number in `package.json`
- run the tests
- create a tag of the version with prefix `v`
- update the `CHANGELOG.md`

**Changelog**:

_Note:_ It is important to keep the version in `CHANGELOG.md` and `package.json` in sync. In general, this works out of the box as designed.
We use changelog (https://github.com/lob/generate-changelog) for generating the `CHANGELOG.md `. The github workflow uses https://github.com/ScottBrenner/generate-changelog-action to generate the changelog for the release.

Therefore, the commit messages should comply to these rules: https://github.com/lob/generate-changelog#usage

**Release notes**
Release notes will be auto generated by github cli (see release.yml).
We may created them manually with something like this:

```console
gh api --method POST -H "Accept: application/vnd.github+json" /repos/mpapenbr/iracelog/releases/generate-notes -f tag_name='v0.18.3'  | jq -r '.body'
```

## Own packages on Github

At the moment (2021-04-25) there is no way to get packages from github repository (https://npm.pkg.github.com) without using a personal access token (PAT).  
So we need to put one in place at `~/.npmrc` which looks like this

```
@mpapenbr:registry=https://npm.pkg.github.com/
//npm.pkg.github.com/:_authToken=<READ_ACCESS_TOKEN>
```

## antd charts

Seems to be pretty new so I'm sure some of the glitches are going to be fixed soon.  
For now:

- avoid using x-values as number. Use strings instead (https://github.com/ant-design/ant-design-charts/issues/797)
- boxplot-outliers (https://github.com/ant-design/ant-design-charts/issues/800)
- references vulnerable d3-color version (https://github.com/ant-design/ant-design-charts/issues/1597). Overruled here in package.json

## eslint >8.0

At the moment (2021-11-27) the reason not updating eslint to >8 is the _react-scripts_ module. Version 4.0.3 requires eslint ^7.11.0.

see https://github.com/facebook/create-react-app/issues/11549 for example

# Solved issues

## "embedded" security issues

The following devDependencies were added in order to fix security issues in embedded packages

- minimist:1.2.6
- nth-check: 2.0.1
- d3-color: 3.1.0

They override the embedded references via resolutions in package.json.

```json
 "resolutions": {
   "minimist": "^1.2.6",
   "nth-check": "^2.0.1",
   "d3-color": "^3.1.0"

  },
```

See https://itnext.io/fixing-security-vulnerabilities-in-npm-dependencies-in-less-than-3-mins-a53af735261d for details.

## Nivo

**FIXED with nivo@0.68**

There are some issues with tooltips in production mode.
Links:

- https://github.com/plouc/nivo/issues/1304
- https://github.com/plouc/nivo/issues/1290

A workaround for nivo@0.67 could be this:

Add this package.json

```
"resolutions": {
  "react-spring": "9.0.1"
}
```

run `yarn install` and the tooltips work in production like in development.
